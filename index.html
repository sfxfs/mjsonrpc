<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>mjsonrpc: mjsonrpc - A JSON-RPC 2.0 Message Parser and Generator Based on cJSON</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">mjsonrpc<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">A lightweight JSON-RPC 2.0 message parser and generator based on cJSON</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">mjsonrpc - A JSON-RPC 2.0 Message Parser and Generator Based on cJSON </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> <img src="https://img.shields.io/github/actions/workflow/status/sfxfs/mjsonrpc/ci.yml" alt="GitHub Actions Workflow Status" class="inline"/> <img src="https://img.shields.io/github/license/sfxfs/mjsonrpc" alt="GitHub License" class="inline"/> <img src="https://img.shields.io/github/commit-activity/t/sfxfs/mjsonrpc" alt="GitHub commit activity" class="inline"/> <img src="https://img.shields.io/github/languages/top/sfxfs/mjsonrpc" alt="GitHub top language" class="inline"/> <img src="https://img.shields.io/github/repo-size/sfxfs/mjsonrpc" alt="GitHub repo size" class="inline"/> <img src="https://img.shields.io/github/downloads/sfxfs/mjsonrpc/latest/total" alt="GitHub Downloads (all assets, latest release)" class="inline"/></p>
<p>[ English | 中文 ]</p>
<h1>Introduction</h1>
<p>This project is lightweight, has minimal dependencies, and can be integrated into various communication methods (TCP, UDP, message queues, etc.). It is simple to use (with only a few functional APIs) and has good performance (using hash-based indexing instead of polling all methods). It also supports batch calls (JSON Array), automatic generation of corresponding error messages or custom error messages based on requests, customizable memory management hooks, notification requests, and more.</p>
<h1>Features</h1>
<ul>
<li><b>Lightweight &amp; Minimal Dependencies</b>: Only depends on cJSON</li>
<li><b>Hash-based Method Indexing</b>: Fast method lookup using double hashing algorithm</li>
<li><b>Batch Requests</b>: Support for JSON Array batch calls</li>
<li><b>Customizable Memory Management</b>: User-defined malloc/free/strdup hooks</li>
<li><b>Thread-Safe</b>: Thread-local storage for memory hooks</li>
<li><b>POSIX Array Params</b>: Support for both object and array parameters</li>
<li><b>Method Enumeration</b>: Query registered methods at runtime</li>
<li><b>Error Logging</b>: Optional error logging hooks for debugging</li>
</ul>
<h1>How to Use</h1>
<p>Simply add the project source files (<b>mjsonrpc.c</b>, <b><a class="el" href="mjsonrpc_8h.html" title="A lightweight JSON-RPC 2.0 message parser and generator based on cJSON.">mjsonrpc.h</a></b>) and the cJSON library to your own project and compile them together. Alternatively, you can use CMake to build and install:</p>
<div class="fragment"><div class="line">cmake -B build &amp;&amp; cmake --build build</div>
<div class="line">sudo cmake --install build</div>
</div><!-- fragment --><h1>Examples</h1>
<h2>Basic Usage</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="mjsonrpc_8h.html">mjsonrpc.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define a simple JSON-RPC method</span></div>
<div class="line">cJSON *hello_world(<a class="code hl_struct" href="structmjrpc__func__ctx__t.html">mjrpc_func_ctx_t</a> *context, cJSON *params, cJSON *<span class="keywordtype">id</span>) {</div>
<div class="line">    cJSON *result = cJSON_CreateString(<span class="stringliteral">&quot;Hello, World!&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <span class="comment">// Initialize mjrpc_handle_t</span></div>
<div class="line">    <a class="code hl_struct" href="structmjrpc__handle.html">mjrpc_handle_t</a>* handle = <a class="code hl_function" href="group__handle__management.html#gacb89ae0f934eef67fdca65012d93a26a">mjrpc_create_handle</a>(0);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Add a method</span></div>
<div class="line">    <a class="code hl_function" href="group__method__management.html#gaf5598bbe9436b5eb2993ac7d6e5ce07c">mjrpc_add_method</a>(handle, hello_world, <span class="stringliteral">&quot;hello&quot;</span>, NULL);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Construct a JSON-RPC request</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *json_request = <span class="stringliteral">&quot;{\&quot;jsonrpc\&quot;:\&quot;2.0\&quot;,\&quot;method\&quot;:\&quot;hello\&quot;,\&quot;id\&quot;:1}&quot;</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Process the request</span></div>
<div class="line">    <span class="keywordtype">int</span> result;</div>
<div class="line">    <span class="keywordtype">char</span> *json_response = <a class="code hl_function" href="group__request__processing.html#ga6b14c69b05520c024f7cebd7ada5c19e">mjrpc_process_str</a>(handle, json_request, &amp;result);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Check return code</span></div>
<div class="line">    <span class="keywordflow">if</span> (result != <a class="code hl_enumvalue" href="mjsonrpc_8h.html#a159beeddeec0dd1c9c984dadbd8e80bbaee79517c749559ac340fe6672c928937">MJRPC_RET_OK</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Error processing request: %d\n&quot;</span>, result);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Check response string</span></div>
<div class="line">    <span class="keywordflow">if</span> (json_response) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Response: %s\n&quot;</span>, json_response);</div>
<div class="line">        free(json_response);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Cleanup</span></div>
<div class="line">    <a class="code hl_function" href="group__handle__management.html#ga5436878cf8f44deaf9e198006092c439">mjrpc_destroy_handle</a>(handle);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__handle__management_html_ga5436878cf8f44deaf9e198006092c439"><div class="ttname"><a href="group__handle__management.html#ga5436878cf8f44deaf9e198006092c439">mjrpc_destroy_handle</a></div><div class="ttdeci">int mjrpc_destroy_handle(mjrpc_handle_t *handle)</div><div class="ttdoc">Destroy a JSON-RPC handle and free all associated memory.</div></div>
<div class="ttc" id="agroup__handle__management_html_gacb89ae0f934eef67fdca65012d93a26a"><div class="ttname"><a href="group__handle__management.html#gacb89ae0f934eef67fdca65012d93a26a">mjrpc_create_handle</a></div><div class="ttdeci">mjrpc_handle_t * mjrpc_create_handle(size_t initial_capacity)</div><div class="ttdoc">Create a new JSON-RPC handle.</div></div>
<div class="ttc" id="agroup__method__management_html_gaf5598bbe9436b5eb2993ac7d6e5ce07c"><div class="ttname"><a href="group__method__management.html#gaf5598bbe9436b5eb2993ac7d6e5ce07c">mjrpc_add_method</a></div><div class="ttdeci">int mjrpc_add_method(mjrpc_handle_t *handle, mjrpc_func function_pointer, const char *method_name, void *arg2func)</div><div class="ttdoc">Register a new RPC method.</div></div>
<div class="ttc" id="agroup__request__processing_html_ga6b14c69b05520c024f7cebd7ada5c19e"><div class="ttname"><a href="group__request__processing.html#ga6b14c69b05520c024f7cebd7ada5c19e">mjrpc_process_str</a></div><div class="ttdeci">char * mjrpc_process_str(const mjrpc_handle_t *handle, const char *request_str, int *ret_code)</div><div class="ttdoc">Process a JSON-RPC request string.</div></div>
<div class="ttc" id="amjsonrpc_8h_html"><div class="ttname"><a href="mjsonrpc_8h.html">mjsonrpc.h</a></div><div class="ttdoc">A lightweight JSON-RPC 2.0 message parser and generator based on cJSON.</div></div>
<div class="ttc" id="amjsonrpc_8h_html_a159beeddeec0dd1c9c984dadbd8e80bbaee79517c749559ac340fe6672c928937"><div class="ttname"><a href="mjsonrpc_8h.html#a159beeddeec0dd1c9c984dadbd8e80bbaee79517c749559ac340fe6672c928937">MJRPC_RET_OK</a></div><div class="ttdeci">@ MJRPC_RET_OK</div><div class="ttdoc">Operation completed successfully.</div><div class="ttdef"><b>Definition</b> <a href="mjsonrpc_8h_source.html#l00087">mjsonrpc.h:87</a></div></div>
<div class="ttc" id="astructmjrpc__func__ctx__t_html"><div class="ttname"><a href="structmjrpc__func__ctx__t.html">mjrpc_func_ctx_t</a></div><div class="ttdoc">Context structure passed to RPC method callback functions.</div><div class="ttdef"><b>Definition</b> <a href="mjsonrpc_8h_source.html#l00121">mjsonrpc.h:121</a></div></div>
<div class="ttc" id="astructmjrpc__handle_html"><div class="ttname"><a href="structmjrpc__handle.html">mjrpc_handle</a></div><div class="ttdoc">Main handle structure for managing RPC methods.</div><div class="ttdef"><b>Definition</b> <a href="mjsonrpc_8h_source.html#l00177">mjsonrpc.h:177</a></div></div>
</div><!-- fragment --><h2>Method with Parameters</h2>
<div class="fragment"><div class="line">cJSON *add(<a class="code hl_struct" href="structmjrpc__func__ctx__t.html">mjrpc_func_ctx_t</a> *ctx, cJSON *params, cJSON *<span class="keywordtype">id</span>) {</div>
<div class="line">    <span class="keywordtype">int</span> a = 0, b = 0;</div>
<div class="line">    cJSON *a_item = cJSON_GetObjectItem(params, <span class="stringliteral">&quot;a&quot;</span>);</div>
<div class="line">    cJSON *b_item = cJSON_GetObjectItem(params, <span class="stringliteral">&quot;b&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (cJSON_IsNumber(a_item)) a = a_item-&gt;valueint;</div>
<div class="line">    <span class="keywordflow">if</span> (cJSON_IsNumber(b_item)) b = b_item-&gt;valueint;</div>
<div class="line">    <span class="keywordflow">return</span> cJSON_CreateNumber(a + b);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <a class="code hl_struct" href="structmjrpc__handle.html">mjrpc_handle_t</a>* h = <a class="code hl_function" href="group__handle__management.html#gacb89ae0f934eef67fdca65012d93a26a">mjrpc_create_handle</a>(8);</div>
<div class="line">    <a class="code hl_function" href="group__method__management.html#gaf5598bbe9436b5eb2993ac7d6e5ce07c">mjrpc_add_method</a>(h, add, <span class="stringliteral">&quot;add&quot;</span>, NULL);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Request with object parameters</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *req = <span class="stringliteral">&quot;{\&quot;jsonrpc\&quot;:\&quot;2.0\&quot;,\&quot;method\&quot;:\&quot;add\&quot;,&quot;</span></div>
<div class="line">                      <span class="stringliteral">&quot;\&quot;params\&quot;:{\&quot;a\&quot;:5,\&quot;b\&quot;:3},\&quot;id\&quot;:1}&quot;</span>;</div>
<div class="line">    <span class="keywordtype">int</span> code;</div>
<div class="line">    <span class="keywordtype">char</span> *resp = <a class="code hl_function" href="group__request__processing.html#ga6b14c69b05520c024f7cebd7ada5c19e">mjrpc_process_str</a>(h, req, &amp;code);</div>
<div class="line">    <span class="comment">// Response: {&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;result&quot;:8,&quot;id&quot;:1}</span></div>
<div class="line">    printf(<span class="stringliteral">&quot;Response: %s\n&quot;</span>, resp);</div>
<div class="line"> </div>
<div class="line">    free(resp);</div>
<div class="line">    <a class="code hl_function" href="group__handle__management.html#ga5436878cf8f44deaf9e198006092c439">mjrpc_destroy_handle</a>(h);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h2>Batch Requests</h2>
<div class="fragment"><div class="line">cJSON *multiply(<a class="code hl_struct" href="structmjrpc__func__ctx__t.html">mjrpc_func_ctx_t</a> *ctx, cJSON *params, cJSON *<span class="keywordtype">id</span>) {</div>
<div class="line">    <span class="keywordtype">int</span> a = cJSON_GetArrayItem(params, 0)-&gt;valueint;</div>
<div class="line">    <span class="keywordtype">int</span> b = cJSON_GetArrayItem(params, 1)-&gt;valueint;</div>
<div class="line">    <span class="keywordflow">return</span> cJSON_CreateNumber(a * b);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <a class="code hl_struct" href="structmjrpc__handle.html">mjrpc_handle_t</a>* h = <a class="code hl_function" href="group__handle__management.html#gacb89ae0f934eef67fdca65012d93a26a">mjrpc_create_handle</a>(8);</div>
<div class="line">    <a class="code hl_function" href="group__method__management.html#gaf5598bbe9436b5eb2993ac7d6e5ce07c">mjrpc_add_method</a>(h, multiply, <span class="stringliteral">&quot;mul&quot;</span>, NULL);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Batch request with multiple calls</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *batch_req = <span class="stringliteral">&quot;[&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{\&quot;jsonrpc\&quot;:\&quot;2.0\&quot;,\&quot;method\&quot;:\&quot;mul\&quot;,\&quot;params\&quot;:[3,4],\&quot;id\&quot;:1},&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{\&quot;jsonrpc\&quot;:\&quot;2.0\&quot;,\&quot;method\&quot;:\&quot;mul\&quot;,\&quot;params\&quot;:[5,6],\&quot;id\&quot;:2}&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;]&quot;</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> code;</div>
<div class="line">    <span class="keywordtype">char</span> *resp = <a class="code hl_function" href="group__request__processing.html#ga6b14c69b05520c024f7cebd7ada5c19e">mjrpc_process_str</a>(h, batch_req, &amp;code);</div>
<div class="line">    <span class="comment">// Response: [{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;result&quot;:12,&quot;id&quot;:1},{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;result&quot;:30,&quot;id&quot;:2}]</span></div>
<div class="line">    printf(<span class="stringliteral">&quot;Batch Response: %s\n&quot;</span>, resp);</div>
<div class="line"> </div>
<div class="line">    free(resp);</div>
<div class="line">    <a class="code hl_function" href="group__handle__management.html#ga5436878cf8f44deaf9e198006092c439">mjrpc_destroy_handle</a>(h);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h2>Custom Error Handling</h2>
<div class="fragment"><div class="line">cJSON *validate_age(<a class="code hl_struct" href="structmjrpc__func__ctx__t.html">mjrpc_func_ctx_t</a> *ctx, cJSON *params, cJSON *<span class="keywordtype">id</span>) {</div>
<div class="line">    cJSON *age = cJSON_GetObjectItem(params, <span class="stringliteral">&quot;age&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (!cJSON_IsNumber(age) || age-&gt;valueint &lt; 0 || age-&gt;valueint &gt; 150) {</div>
<div class="line">        ctx-&gt;<a class="code hl_variable" href="structmjrpc__func__ctx__t.html#a37c31cf01cfafcf538d3f2f287b93b6c">error_code</a> = -32001;  <span class="comment">// Custom error code</span></div>
<div class="line">        ctx-&gt;<a class="code hl_variable" href="structmjrpc__func__ctx__t.html#a6d5947fec617502b8da9504ed3edf9ea">error_message</a> = strdup(<span class="stringliteral">&quot;Invalid age: must be 0-150&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> cJSON_CreateString(<span class="stringliteral">&quot;Age validated&quot;</span>);</div>
<div class="line">}</div>
<div class="ttc" id="astructmjrpc__func__ctx__t_html_a37c31cf01cfafcf538d3f2f287b93b6c"><div class="ttname"><a href="structmjrpc__func__ctx__t.html#a37c31cf01cfafcf538d3f2f287b93b6c">mjrpc_func_ctx_t::error_code</a></div><div class="ttdeci">int32_t error_code</div><div class="ttdoc">Error code to be set by the method implementation (0 = no error)</div><div class="ttdef"><b>Definition</b> <a href="mjsonrpc_8h_source.html#l00126">mjsonrpc.h:126</a></div></div>
<div class="ttc" id="astructmjrpc__func__ctx__t_html_a6d5947fec617502b8da9504ed3edf9ea"><div class="ttname"><a href="structmjrpc__func__ctx__t.html#a6d5947fec617502b8da9504ed3edf9ea">mjrpc_func_ctx_t::error_message</a></div><div class="ttdeci">char * error_message</div><div class="ttdoc">Error message to be set by the method implementation (will be freed automatically)</div><div class="ttdef"><b>Definition</b> <a href="mjsonrpc_8h_source.html#l00130">mjsonrpc.h:130</a></div></div>
</div><!-- fragment --><h2>Custom Memory Management</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span>* my_malloc(<span class="keywordtype">size_t</span> size) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Allocating %zu bytes\n&quot;</span>, size);</div>
<div class="line">    <span class="keywordflow">return</span> malloc(size);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> my_free(<span class="keywordtype">void</span>* ptr) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Freeing %p\n&quot;</span>, ptr);</div>
<div class="line">    free(ptr);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span>* my_strdup(<span class="keyword">const</span> <span class="keywordtype">char</span>* str) {</div>
<div class="line">    <span class="keywordtype">char</span>* dup = my_malloc(strlen(str) + 1);</div>
<div class="line">    <span class="keywordflow">if</span> (dup) strcpy(dup, str);</div>
<div class="line">    <span class="keywordflow">return</span> dup;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <span class="comment">// Set custom memory hooks</span></div>
<div class="line">    <a class="code hl_function" href="group__memory__hooks.html#ga0d2da3f4fe7ade41032143097cb0de32">mjrpc_set_memory_hooks</a>(my_malloc, my_free, my_strdup);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_struct" href="structmjrpc__handle.html">mjrpc_handle_t</a>* h = <a class="code hl_function" href="group__handle__management.html#gacb89ae0f934eef67fdca65012d93a26a">mjrpc_create_handle</a>(8);</div>
<div class="line">    <span class="comment">// ... use handle ...</span></div>
<div class="line">    <a class="code hl_function" href="group__handle__management.html#ga5436878cf8f44deaf9e198006092c439">mjrpc_destroy_handle</a>(h);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Reset to default</span></div>
<div class="line">    <a class="code hl_function" href="group__memory__hooks.html#ga0d2da3f4fe7ade41032143097cb0de32">mjrpc_set_memory_hooks</a>(NULL, NULL, NULL);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__memory__hooks_html_ga0d2da3f4fe7ade41032143097cb0de32"><div class="ttname"><a href="group__memory__hooks.html#ga0d2da3f4fe7ade41032143097cb0de32">mjrpc_set_memory_hooks</a></div><div class="ttdeci">int mjrpc_set_memory_hooks(mjrpc_malloc_func malloc_func, mjrpc_free_func free_func, mjrpc_strdup_func strdup_func)</div><div class="ttdoc">Set custom memory management functions.</div></div>
</div><!-- fragment --><h2>Error Logging</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> my_error_logger(<span class="keyword">const</span> <span class="keywordtype">char</span>* msg, <span class="keywordtype">int</span> code) {</div>
<div class="line">    fprintf(stderr, <span class="stringliteral">&quot;[MJSONRPC ERROR] %s (code: %d)\n&quot;</span>, msg, code);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <span class="comment">// Enable error logging</span></div>
<div class="line">    <a class="code hl_function" href="group__memory__hooks.html#ga9f3ddb2b7f3132e7e954eccecbb0a944">mjrpc_set_error_log_hook</a>(my_error_logger);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_struct" href="structmjrpc__handle.html">mjrpc_handle_t</a>* h = <a class="code hl_function" href="group__handle__management.html#gacb89ae0f934eef67fdca65012d93a26a">mjrpc_create_handle</a>(8);</div>
<div class="line">    <span class="comment">// ... errors will be logged automatically ...</span></div>
<div class="line">    <a class="code hl_function" href="group__handle__management.html#ga5436878cf8f44deaf9e198006092c439">mjrpc_destroy_handle</a>(h);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Disable error logging</span></div>
<div class="line">    <a class="code hl_function" href="group__memory__hooks.html#ga9f3ddb2b7f3132e7e954eccecbb0a944">mjrpc_set_error_log_hook</a>(NULL);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__memory__hooks_html_ga9f3ddb2b7f3132e7e954eccecbb0a944"><div class="ttname"><a href="group__memory__hooks.html#ga9f3ddb2b7f3132e7e954eccecbb0a944">mjrpc_set_error_log_hook</a></div><div class="ttdeci">int mjrpc_set_error_log_hook(mjrpc_error_log_func error_log_func)</div><div class="ttdoc">Set custom error logging function.</div></div>
</div><!-- fragment --><h1>Performance</h1>
<h2>Hash Table Performance Comparison</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Operation   </th><th class="markdownTableHeadRight">Quadratic Probing   </th><th class="markdownTableHeadRight">Double Hashing (new)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Avg probes (low load)   </td><td class="markdownTableBodyRight">~1.5   </td><td class="markdownTableBodyRight">~1.2    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Avg probes (high load)   </td><td class="markdownTableBodyRight">~4.0   </td><td class="markdownTableBodyRight">~2.0    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Worst case   </td><td class="markdownTableBodyRight">O(n)   </td><td class="markdownTableBodyRight">O(n)   </td></tr>
</table>
<h2>Method Registration Throughput</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadRight">Methods   </th><th class="markdownTableHeadRight">Add (ops/sec)   </th><th class="markdownTableHeadRight">Delete (ops/sec)   </th><th class="markdownTableHeadRight">Lookup (ops/sec)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">100   </td><td class="markdownTableBodyRight">~500K   </td><td class="markdownTableBodyRight">~600K   </td><td class="markdownTableBodyRight">~800K    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">1000   </td><td class="markdownTableBodyRight">~450K   </td><td class="markdownTableBodyRight">~550K   </td><td class="markdownTableBodyRight">~750K    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">10000   </td><td class="markdownTableBodyRight">~400K   </td><td class="markdownTableBodyRight">~500K   </td><td class="markdownTableBodyRight">~700K   </td></tr>
</table>
<p><em>Tested on Intel i7, 3.2GHz, single-threaded</em></p>
<h1>FAQ</h1>
<h2>Q: Is mjsonrpc thread-safe?</h2>
<p><b>A:</b> The library uses thread-local storage for memory hooks, making it safe to use from multiple threads. However, you should protect shared <code>mjrpc_handle_t</code> instances with your own synchronization (mutexes) if accessed from multiple threads concurrently.</p>
<h2>Q: How do I handle notification requests (no response)?</h2>
<p><b>A:</b> Notification requests are those without an <code>id</code> field. The library processes them normally but returns NULL for the response. Check the return code for <code>MJRPC_RET_OK_NOTIFICATION</code>.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *notif = <span class="stringliteral">&quot;{\&quot;jsonrpc\&quot;:\&quot;2.0\&quot;,\&quot;method\&quot;:\&quot;log\&quot;,\&quot;params\&quot;:{\&quot;msg\&quot;:\&quot;hello\&quot;}}&quot;</span>;</div>
<div class="line"><span class="keywordtype">int</span> code;</div>
<div class="line"><span class="keywordtype">char</span> *resp = <a class="code hl_function" href="group__request__processing.html#ga6b14c69b05520c024f7cebd7ada5c19e">mjrpc_process_str</a>(h, notif, &amp;code);</div>
<div class="line"><span class="keywordflow">if</span> (code == <a class="code hl_enumvalue" href="mjsonrpc_8h.html#a159beeddeec0dd1c9c984dadbd8e80bba51379d7873df3018fb54dcf6fd78bcd4">MJRPC_RET_OK_NOTIFICATION</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Notification processed (no response)\n&quot;</span>);</div>
<div class="line">}</div>
<div class="ttc" id="amjsonrpc_8h_html_a159beeddeec0dd1c9c984dadbd8e80bba51379d7873df3018fb54dcf6fd78bcd4"><div class="ttname"><a href="mjsonrpc_8h.html#a159beeddeec0dd1c9c984dadbd8e80bba51379d7873df3018fb54dcf6fd78bcd4">MJRPC_RET_OK_NOTIFICATION</a></div><div class="ttdeci">@ MJRPC_RET_OK_NOTIFICATION</div><div class="ttdoc">Operation completed successfully (notification request)</div><div class="ttdef"><b>Definition</b> <a href="mjsonrpc_8h_source.html#l00090">mjsonrpc.h:90</a></div></div>
</div><!-- fragment --><h2>Q: Can I use array parameters instead of object parameters?</h2>
<p><b>A:</b> Yes! Both object and array parameters are supported:</p>
<div class="fragment"><div class="line"><span class="comment">// Array parameters</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *req = <span class="stringliteral">&quot;{\&quot;jsonrpc\&quot;:\&quot;2.0\&quot;,\&quot;method\&quot;:\&quot;add\&quot;,\&quot;params\&quot;:[1,2],\&quot;id\&quot;:1}&quot;</span>;</div>
</div><!-- fragment --><h2>Q: How do I enumerate all registered methods?</h2>
<p><b>A:</b> Use <code><a class="el" href="group__method__management.html#gaf07661624df3847093811e83bfd2cb61" title="Enumerate all registered methods.">mjrpc_enum_methods()</a></code> to get an array of method names:</p>
<div class="fragment"><div class="line">cJSON *methods = <a class="code hl_function" href="group__method__management.html#gaf07661624df3847093811e83bfd2cb61">mjrpc_enum_methods</a>(handle, NULL, NULL);</div>
<div class="line"><span class="comment">// methods is a JSON array of method name strings</span></div>
<div class="line">cJSON_Delete(methods);</div>
<div class="ttc" id="agroup__method__management_html_gaf07661624df3847093811e83bfd2cb61"><div class="ttname"><a href="group__method__management.html#gaf07661624df3847093811e83bfd2cb61">mjrpc_enum_methods</a></div><div class="ttdeci">int mjrpc_enum_methods(const mjrpc_handle_t *handle, void(*callback)(const char *method_name, void *arg, void *user_data), void *user_data)</div><div class="ttdoc">Enumerate all registered methods.</div></div>
</div><!-- fragment --><h2>Q: What happens if the hash table needs to resize?</h2>
<p><b>A:</b> The library automatically resizes the hash table when the load factor exceeds 0.75. This is transparent to the user. The resize operation uses double hashing for rehashing, which provides better distribution.</p>
<h2>Q: How do I clean up resources properly?</h2>
<p><b>A:</b> Always call <code><a class="el" href="group__handle__management.html#ga5436878cf8f44deaf9e198006092c439" title="Destroy a JSON-RPC handle and free all associated memory.">mjrpc_destroy_handle()</a></code> when done. This frees all internally allocated memory. Any cJSON objects returned to you should be freed with <code>cJSON_Delete()</code> or <code>free()</code> as documented.</p>
<h1>References</h1>
<ul>
<li><a href="https://github.com/DaveGamble/cJSON">DaveGamble/cJSON</a></li>
<li><a href="https://www.jsonrpc.org/specification">JSON-RPC Specification</a></li>
<li><a href="https://github.com/hmng/jsonrpc-c">hmng/jsonrpc-c</a></li>
<li><a href="https://sfxfs.github.io/mjsonrpc">Doxygen Documentation</a> </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
